<!DOCTYPE html>

<html lang="es" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>conexion &#8212; documentación de PROYECTODAM24_25 - v.0.0.1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=8ee129b9"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=d190bf04"></script>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Código fuente para conexion</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt6</span><span class="w"> </span><span class="kn">import</span> <span class="n">QtSql</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtCore</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">alquileres</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">conexion</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">eventos</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">propiedades</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">var</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">eventos</span><span class="w"> </span><span class="kn">import</span> <span class="n">Eventos</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">facturas</span><span class="w"> </span><span class="kn">import</span> <span class="n">Facturas</span>


<div class="viewcode-block" id="Conexion">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion">[documentos]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Conexion</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    @staticmethod</span>
<span class="sd">    método de una clase que no depende de una instancia específica de esa clase.</span>
<span class="sd">    Se puede llamarlo directamente a través de la clase, sin necesidad de crear un objeto de esa clase.</span>
<span class="sd">    Es útil en comportamientos o funcionalidades que son más a una clase en general que a una instancia en particular.</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="Conexion.db_conexion">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.db_conexion">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">db_conexion</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: conexion con la base de datos.</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método para establecer conexión con la base de datos</span>
<span class="sd">        Si éxito devuelve True, en caso contrario devuelve False.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Verifica si el archivo de base de datos existe</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;bbdd.sqlite&#39;</span><span class="p">):</span>
            <span class="n">eventos</span><span class="o">.</span><span class="n">Eventos</span><span class="o">.</span><span class="n">crearMensajeError</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s1">&#39;El archivo de la base de datos no existe.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Crear la conexión con la base de datos SQLite</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlDatabase</span><span class="o">.</span><span class="n">addDatabase</span><span class="p">(</span><span class="s1">&#39;QSQLITE&#39;</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">setDatabaseName</span><span class="p">(</span><span class="s1">&#39;bbdd.sqlite&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">open</span><span class="p">():</span>
            <span class="c1"># Verificar si la base de datos contiene tablas</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="s2">&quot;SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>  <span class="c1"># Si no hay tablas</span>
                <span class="n">eventos</span><span class="o">.</span><span class="n">Eventos</span><span class="o">.</span><span class="n">crearMensajeError</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;Base de datos vacía o no válida.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">eventos</span><span class="o">.</span><span class="n">Eventos</span><span class="o">.</span><span class="n">crearMensajeInfo</span><span class="p">(</span><span class="s2">&quot;Aviso&quot;</span><span class="p">,</span> <span class="s2">&quot;Conexión a la Base de Datos realizada&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">eventos</span><span class="o">.</span><span class="n">Eventos</span><span class="o">.</span><span class="n">crearMensajeError</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No se pudo abrir la base de datos.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    GESTION DE CLIENTES</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="Conexion.listaProv">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listaProv">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listaProv</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: lista de provincias</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que devuelve la lista de provincias</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">listaprov</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
        <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM provincias&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">listaprov</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">listaprov</span></div>


<div class="viewcode-block" id="Conexion.listaMunicipio">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listaMunicipio">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listaMunicipio</span><span class="p">(</span><span class="n">provincia</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param provincia: nombre de la provincia</span>
<span class="sd">        :type provincia: str</span>
<span class="sd">        :return: lista de municipios de una provincia</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que devuelve todos los municipios de una provincia</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listamunicipio</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;SELECT * FROM municipios WHERE idprov = (SELECT idprov FROM provincias WHERE provincia = :provincia)&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:provincia&quot;</span><span class="p">,</span> <span class="n">provincia</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">listamunicipio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">listamunicipio</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error al cargar municipios&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.altaCliente">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.altaCliente">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">altaCliente</span><span class="p">(</span><span class="n">nuevocli</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param nuevocli: lista de datos del cliente</span>
<span class="sd">        :type nuevocli: list</span>
<span class="sd">        :return: éxito en la creación de un cliente</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que inserta datos cliente en la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;INSERT into clientes (dnicli, altacli, apelcli, nomecli, emailcli, movilcli, dircli, provcli, municli) values (:dnicli, :altacli, :apelcli, :nomecli, :emailcli, :movilcli, :dircli, :provcli, :municli)&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dnicli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevocli</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:altacli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevocli</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:apelcli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevocli</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:nomecli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevocli</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:emailcli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevocli</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:movilcli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevocli</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dircli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevocli</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:provcli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevocli</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:municli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevocli</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error alta cliente&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.listadoClientes">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listadoClientes">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listadoClientes</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: devuelve la lista de clientes</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que devuelve el listado total de clientes de la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">historico</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkHistoriacli</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">historico</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM clientes ORDER BY apelcli, nomecli ASC&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                        <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM clientes WHERE bajacli is null ORDER BY apelcli, nomecli ASC&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                        <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">listado</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al listar clientes&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.datosOneCliente">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.datosOneCliente">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">datosOneCliente</span><span class="p">(</span><span class="n">dni</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param dni: dni de un cliente</span>
<span class="sd">        :type dni: str</span>
<span class="sd">        :return: datos de un cliente</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que devuelve los datos de un cliente al introducir su dni</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM clientes WHERE dnicli = :dni&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dni&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">dni</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">registro</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al cargar UN cliente en la tabla.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.modifCliente">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.modifCliente">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modifCliente</span><span class="p">(</span><span class="n">registro</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param registro: datos de un cliente</span>
<span class="sd">        :type registro: list</span>
<span class="sd">        :return: éxito en la modificación de detos de un cliente</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que modifica los datos de un cliente en la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;select count(*) from clientes where dnicli = :dni&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dni&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># verificamos que solo nos devuelve un resultado, la fila para el dni que buscamos</span>

                    <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                        <span class="s2">&quot;UPDATE clientes set altacli= :altacli, apelcli = :apelcli, nomecli= :nomecli, emailcli = :emailcli, movilcli = :movilcli, dircli = :dircli, provcli=:provcli, municli=:municli, bajacli = :bajacli WHERE dnicli = :dni&quot;</span><span class="p">)</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dni&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:altacli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:apelcli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:nomecli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:emailcli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:movilcli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dircli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:provcli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:municli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">registro</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajacli&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QVariant</span><span class="p">())</span>  <span class="c1"># QVariant añade un null a la BD</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajacli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">9</span><span class="p">]))</span>

                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                        <span class="k">return</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al modificar un cliente en conexion.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.bajaCliente">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.bajaCliente">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bajaCliente</span><span class="p">(</span><span class="n">dni</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param dni: dni de un cliente</span>
<span class="sd">        :type dni: str</span>
<span class="sd">        :return: éxito al dar de baja a un cliente</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que añade fecha de baja a un cliente</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT COUNT(*) from clientes where dnicli = :dni&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dni&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">dni</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE clientes SET bajacli = :bajacli WHERE dnicli = :dni&quot;</span><span class="p">)</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajacli&quot;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dni&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">dni</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                        <span class="k">return</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error en la conexión al dar de baja cliente&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    GESTION DE PROPIEDADES</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="Conexion.cargarMunicipios">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.cargarMunicipios">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cargarMunicipios</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listaMuni</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM MUNICIPIOS&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">listaMuni</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">listaMuni</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error cargando municipios&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.cargarTipoprop">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.cargarTipoprop">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cargarTipoprop</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: todos los tipos de propiedad</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que devuelve todos los tipos de propiedad almacenados en la bd</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT tipo from tipopropiedad &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
                <span class="k">return</span> <span class="n">registro</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error cargando tipos de propiedad&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.altaTipoprop">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.altaTipoprop">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">altaTipoprop</span><span class="p">(</span><span class="n">tipo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param tipo: nuevo tipo de propiedad</span>
<span class="sd">        :type tipo: str</span>
<span class="sd">        :return: tipos de propiedad</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que introduce un nuevo tipo de propiedad y devuelve la lista de tipos de propiedad</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT into tipopropiedad (tipo) values (:tipo) &quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:tipo&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">tipo</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="n">registro</span> <span class="o">=</span> <span class="n">Conexion</span><span class="o">.</span><span class="n">cargarTipoprop</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">registro</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">registro</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error en conexion al dar de alta tipo propiedad&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.bajaTipoprop">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.bajaTipoprop">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bajaTipoprop</span><span class="p">(</span><span class="n">tipo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param tipo: tipo de propiedad</span>
<span class="sd">        :type tipo: str</span>
<span class="sd">        :return: éxito o no en la eliminación de un tipo de propiedad</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que elimina un tipo de propiedad</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;DELETE from tipopropiedad where tipo = :tipo &quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:tipo&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">tipo</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">numRowsAffected</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error en conexion al dar de baja tipo propiedad&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.altaPropiedad">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.altaPropiedad">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">altaPropiedad</span><span class="p">(</span><span class="n">propiedad</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param propiedad: datos de una propiedad</span>
<span class="sd">        :type propiedad: list</span>
<span class="sd">        :return: éxito al introducir propiedad en la base de datos</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que introduce una nueva propiedad en la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;INSERT into propiedades (alta,direccion,provincia,municipio,tipo_propiedad,num_habitaciones,num_banos,superficie,precio_alquiler,precio_venta,codigo_postal,descripcion,tipo_operacion,estado,nombre_propietario,movil) values (:alta,:direccion,:provincia,:municipio,:tipo_propiedad,:num_habitaciones,:num_banos,:superficie,:precio_alquiler,:precio_venta,:codigo_postal,:descripcion,:tipo_operacion,:estado,:nombre_propietario,:movil) &quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:alta&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:direccion&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:provincia&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:municipio&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:tipo_propiedad&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:num_habitaciones&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:num_banos&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:superficie&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:precio_alquiler&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:precio_venta&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">9</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:codigo_postal&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">10</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:descripcion&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">11</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:tipo_operacion&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">12</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:estado&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">13</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:nombre_propietario&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">14</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:movil&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">15</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>


        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al dar de alta propiedad en conexion&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.modifProp">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.modifProp">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modifProp</span><span class="p">(</span><span class="n">propiedad</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param propiedad: datos de propiedad</span>
<span class="sd">        :type propiedad: list</span>
<span class="sd">        :return: éxito en la modificación de los datos de una propiedad</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que modifica los datos de propiedad en la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;select count(*) from propiedades where codigo = :codigo&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:codigo&quot;</span><span class="p">,</span> <span class="n">propiedad</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># verificamos que solo nos devuelve un resultado, la fila para el codigo que buscamos</span>

                    <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                        <span class="s2">&quot;UPDATE propiedades set alta = :alta, baja = :baja, direccion = :direccion, municipio = :municipio, provincia = :provincia, tipo_propiedad = :tipo_propiedad, num_habitaciones=:num_habitaciones, num_banos = :num_banos, superficie = :superficie, precio_alquiler = :precio_alquiler, precio_venta = :precio_venta, codigo_postal = :codigo_postal, descripcion = :descripcion, tipo_operacion = :tipo_operacion, estado=:estado, nombre_propietario =:nombre_propietario, movil =:movil WHERE codigo = :codigo&quot;</span><span class="p">)</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:codigo&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:alta&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:direccion&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:provincia&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:municipio&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:tipo_propiedad&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:num_habitaciones&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:num_banos&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:superficie&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">9</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:precio_alquiler&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">10</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:precio_venta&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">11</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:codigo_postal&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">12</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:descripcion&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">13</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:tipo_operacion&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">14</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:estado&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">15</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:nombre_propietario&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">16</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:movil&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">17</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">propiedad</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:baja&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QVariant</span><span class="p">())</span>  <span class="c1"># QVariant añade un null a la BD</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:baja&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                        <span class="k">return</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al modificar propiedad en conexión.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.bajaProp">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.bajaProp">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bajaProp</span><span class="p">(</span><span class="n">propiedad</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param propiedad: datos de una propiedad</span>
<span class="sd">        :type propiedad: list</span>
<span class="sd">        :return: éxito al dar de baja a una propiedad</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;select count(*) from propiedades where codigo = :codigo&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:codigo&quot;</span><span class="p">,</span> <span class="n">propiedad</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># verificamos que solo nos devuelve un resultado a consulta, por tanto la propiedad existe.</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;update propiedades set baja =:baja, estado =:estado where codigo = :codigo &quot;</span><span class="p">)</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:codigo&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:baja&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span>
                                                     <span class="mi">2</span><span class="p">]))</span>  <span class="c1"># dejamos el segundo espacio del array para fecha de alta, y comprobar mas tarde que no sea posterior a fecha de baja</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:estado&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                        <span class="k">return</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al dar de baja propiedad en conexión.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.listadoPropiedades">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listadoPropiedades">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listadoPropiedades</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: datos filtrados de todas las propiedades</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">historico</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkHistoriaprop</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
            <span class="n">municipio</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbMuniprop</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="n">filtrado</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnBuscaTipoProp</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
            <span class="n">tipoSeleccionado</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbTipoprop</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

            <span class="n">base_query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM propiedades&quot;</span>
            <span class="n">condiciones</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">parametros_bind</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">historico</span><span class="p">:</span>
                <span class="n">condiciones</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;baja is NULL&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">filtrado</span><span class="p">:</span>
                <span class="n">condiciones</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;tipo_propiedad = :tipo_propiedad&quot;</span><span class="p">)</span>
                <span class="n">parametros_bind</span><span class="p">[</span><span class="s2">&quot;:tipo_propiedad&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tipoSeleccionado</span>
                <span class="n">condiciones</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;municipio = :municipio&quot;</span><span class="p">)</span>
                <span class="n">parametros_bind</span><span class="p">[</span><span class="s2">&quot;:municipio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">municipio</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">historico</span><span class="p">:</span>
                <span class="n">condiciones</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;estado = &#39;Disponible&#39;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">condiciones</span><span class="p">:</span>
                <span class="n">base_query</span> <span class="o">+=</span> <span class="s2">&quot; WHERE &quot;</span> <span class="o">+</span> <span class="s2">&quot; AND &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">condiciones</span><span class="p">)</span>
            <span class="n">base_query</span> <span class="o">+=</span> <span class="s2">&quot; ORDER BY municipio ASC&quot;</span>

            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">base_query</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">clave</span><span class="p">,</span> <span class="n">valor</span> <span class="ow">in</span> <span class="n">parametros_bind</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="n">clave</span><span class="p">,</span> <span class="n">valor</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                    <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">listado</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al listar propiedades en listadoPropiedades&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.datosOnePropiedad">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.datosOnePropiedad">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">datosOnePropiedad</span><span class="p">(</span><span class="n">codigo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param codigo: codigo de propiedad</span>
<span class="sd">        :type codigo: int</span>
<span class="sd">        :return: datos de una propiedad</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM propiedades WHERE codigo = :codigo&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:codigo&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">codigo</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">registro</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al cargar UNA propiedad en conexion.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.cargarAllPropiedadesBD">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.cargarAllPropiedadesBD">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cargarAllPropiedadesBD</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: datos de todas las propiedades</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que devuelve los datos de todas las propiedades almacenadasen la BD</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">base_query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM propiedades ORDER BY municipio ASC&quot;</span>

            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">base_query</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                    <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">listado</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al listar propiedades en cargarAllpropiedades&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    GESTION DE VENDEDORES</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="Conexion.altaVendedor">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.altaVendedor">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">altaVendedor</span><span class="p">(</span><span class="n">nuevoVendedor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param nuevoVendedor: datos de un vendedor</span>
<span class="sd">        :type nuevoVendedor: list</span>
<span class="sd">        :return: éxito en añadir a un vendedor a la base de datos</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que añade un nuevo vendedor a la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;INSERT into vendedores (dniVendedor,nombreVendedor,altaVendedor,movilVendedor,mailVendedor,delegacionVendedor) values (:dniVendedor, :nombreVendedor, :altaVendedor, :movilVendedor, :mailVendedor, :delegacionVendedor)&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dniVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevoVendedor</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:nombreVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevoVendedor</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:altaVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevoVendedor</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:movilVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevoVendedor</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:mailVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevoVendedor</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:delegacionVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevoVendedor</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error alta vendedor en conexion&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.datosOneVendedor">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.datosOneVendedor">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">datosOneVendedor</span><span class="p">(</span><span class="n">valor</span><span class="p">,</span> <span class="n">tipo_busqueda</span><span class="o">=</span><span class="s2">&quot;idVendedor&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param valor: valor del tipo de búsqueda que se introduzca introducida</span>
<span class="sd">        :type valor: object</span>
<span class="sd">        :param tipo_busqueda: nombre de la columna de bd por la que se va a realizar la búsqueda</span>
<span class="sd">        :type tipo_busqueda: str</span>
<span class="sd">        :return: datos de un vendedor</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que devuelve los datos de un vendedor en función de un parámetro de búsqueda, siendo su id el predeterminado</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM vendedores WHERE &quot;</span> <span class="o">+</span> <span class="n">tipo_busqueda</span> <span class="o">+</span> <span class="s2">&quot; = :valor&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:valor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">valor</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">registro</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al cargar UN cliente en la tabla.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.listadoVendedores">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listadoVendedores">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listadoVendedores</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: datos de vendedores</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que devuelve la lista de vendedores</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">historico</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkHistoriaVen</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">historico</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM vendedores ORDER BY idVendedor ASC&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                        <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM vendedores WHERE bajaVendedor is null ORDER BY idVendedor ASC&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                        <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">listado</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al listar vendedores&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.listadoFacturas">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listadoFacturas">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listadoFacturas</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Devuelve el listado de todas las facturas.</span>

<span class="sd">            Procedimiento:</span>
<span class="sd">            1. Prepara y ejecuta una consulta SQL para obtener todas las facturas ordenadas por ID.</span>
<span class="sd">            2. Recorre los resultados de la consulta y los añade a una lista.</span>

<span class="sd">            Excepciones:</span>
<span class="sd">            - Captura y muestra cualquier excepción que ocurra durante el proceso de obtención de datos.</span>

<span class="sd">            @param None</span>
<span class="sd">            @return list: Lista de todas las facturas.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM facturas ORDER BY id ASC&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                    <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">listado</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al listar facturas&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.bajaVendedor">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.bajaVendedor">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bajaVendedor</span><span class="p">(</span><span class="n">dni</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param dni: dni de un vendedor</span>
<span class="sd">        :type dni: str</span>
<span class="sd">        :return: éxito al dar de baja a un vendedor en la base de datos</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que añade una fecha de baja al vendedor</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT COUNT(*) from vendedores where dniVendedor = :dni&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dni&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">dni</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE vendedores SET bajaVendedor = :bajaVendedor WHERE dniVendedor = :dni&quot;</span><span class="p">)</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajaVendedor&quot;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dni&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">dni</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                        <span class="k">return</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error en la conexión al dar de baja vendedor&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.modifVendedor">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.modifVendedor">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modifVendedor</span><span class="p">(</span><span class="n">registro</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param registro: datos de vendedor</span>
<span class="sd">        :type registro: list</span>
<span class="sd">        :return: éxito al modificar datos de vendedor en la base de datos</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que modifica los datos de un vendedor en la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;select count(*) from vendedores where idVendedor = :id&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># verificamos que solo nos devuelve un resultado, la fila para el dni que buscamos</span>

                    <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                        <span class="s2">&quot;UPDATE vendedores set nombreVendedor= :nombreVendedor, altaVendedor = :altaVendedor, bajaVendedor= :bajaVendedor, movilVendedor = :movilVendedor, mailVendedor = :mailVendedor, delegacionVendedor = :delegacionVendedor WHERE idVendedor = :id&quot;</span><span class="p">)</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:nombreVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:altaVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:movilVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:mailVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:delegacionVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">registro</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajaVendedor&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QVariant</span><span class="p">())</span>  <span class="c1"># QVariant añade un null a la BD</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajaVendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>

                    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                        <span class="k">return</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al modificar un vendedor en conexion.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.cargarAllVendedoresBD">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.cargarAllVendedoresBD">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cargarAllVendedoresBD</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: datos de todos los vendedores</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que devuelve todos los datos de los vendedores en la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">base_query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM vendedores ORDER BY idVendedor ASC&quot;</span>

            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">base_query</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                    <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">listado</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al listar vendedores en cargarAllpropiedades&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    GESTION DE FACTURAS</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="Conexion.altaFactura">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.altaFactura">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">altaFactura</span><span class="p">(</span><span class="n">registro</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Añade una nueva factura a la base de datos.</span>

<span class="sd">            Procedimiento:</span>
<span class="sd">            1. Prepara y ejecuta una consulta SQL para insertar una nueva factura con la fecha y el DNI del cliente.</span>
<span class="sd">            2. Devuelve True si la inserción es exitosa, de lo contrario devuelve False.</span>

<span class="sd">            Excepciones:</span>
<span class="sd">            - Captura y muestra cualquier excepción que ocurra durante el proceso de inserción de la factura.</span>

<span class="sd">            @param registro: Lista con los datos de la factura. El primer elemento es la fecha de la factura y el segundo es el DNI del cliente.</span>
<span class="sd">            @type registro: list</span>
<span class="sd">            @return: Éxito de la inserción de la factura.</span>
<span class="sd">            @rtype: bool</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT INTO FACTURAS (fechafac, dnicli) values (:fechafac,:dnicli)&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:fechafac&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dnicli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al dar de alta factura en conexion.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.eliminarFactura">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.eliminarFactura">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">eliminarFactura</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           Elimina una factura de la base de datos.</span>

<span class="sd">           Procedimiento:</span>
<span class="sd">           1. Prepara y ejecuta una consulta SQL para eliminar una factura por su ID.</span>
<span class="sd">           2. Devuelve True si la eliminación es exitosa, de lo contrario devuelve False.</span>

<span class="sd">           Excepciones:</span>
<span class="sd">           - Captura y muestra cualquier excepción que ocurra durante el proceso de eliminación de la factura.</span>

<span class="sd">           @param id: ID de la factura a eliminar.</span>
<span class="sd">           @type id: int</span>
<span class="sd">           @return: Éxito de la eliminación de la factura.</span>
<span class="sd">           @rtype: bool</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;DELETE FROM facturas WHERE id = :id&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:id&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">numRowsAffected</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al eliminar factura en conexion.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.altaVenta">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.altaVenta">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">altaVenta</span><span class="p">(</span><span class="n">registro</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Añade una nueva venta a la base de datos.</span>

<span class="sd">            Procedimiento:</span>
<span class="sd">            1. Prepara y ejecuta una consulta SQL para insertar una nueva venta con los datos proporcionados.</span>
<span class="sd">            2. Si la inserción es exitosa, actualiza el estado de la propiedad a &#39;Vendido&#39; y establece la fecha de baja.</span>
<span class="sd">            3. Devuelve True si la inserción y la actualización son exitosas, de lo contrario devuelve False.</span>

<span class="sd">            Excepciones:</span>
<span class="sd">            - Captura y muestra cualquier excepción que ocurra durante el proceso de inserción de la venta.</span>

<span class="sd">            @param registro: Lista con los datos de la venta. El primer elemento es el ID de la factura, el segundo es el código de la propiedad y el tercero es el ID del agente.</span>
<span class="sd">            @type registro: list</span>
<span class="sd">            @return: Éxito de la inserción de la venta.</span>
<span class="sd">            @rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT INTO ventas (facventa, codprop, agente) VALUES (:facventa, :codprop, :agente)&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:facventa&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:codprop&quot;</span><span class="p">,</span> <span class="n">registro</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:agente&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="n">update_query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">update_query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                    <span class="s2">&quot;UPDATE propiedades SET estado = &#39;Vendido&#39;, baja = :fechaBaja WHERE codigo = :codigo&quot;</span><span class="p">)</span>
                <span class="n">update_query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:fechaBaja&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QVariant</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">)))</span>
                <span class="n">update_query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:codigo&quot;</span><span class="p">,</span> <span class="n">registro</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">update_query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error en la ejecución de la consulta de actualización:&quot;</span><span class="p">,</span> <span class="n">update_query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error en la ejecución de la consulta de inserción:&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al dar de alta factura en conexion:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.listadoVentas">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listadoVentas">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listadoVentas</span><span class="p">(</span><span class="n">idFactura</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Devuelve el listado de ventas asociadas a una factura específica.</span>

<span class="sd">            Procedimiento:</span>
<span class="sd">            1. Prepara y ejecuta una consulta SQL para obtener las ventas asociadas a la factura.</span>
<span class="sd">            2. Recorre los resultados de la consulta y los añade a una lista.</span>

<span class="sd">            Excepciones:</span>
<span class="sd">            - Captura y muestra cualquier excepción que ocurra durante el proceso de obtención de datos.</span>

<span class="sd">            @param idFactura: ID de la factura para la cual se desean obtener las ventas.</span>
<span class="sd">            @type idFactura: int</span>
<span class="sd">            @return: Lista de ventas asociadas a la factura.</span>
<span class="sd">            @rtype: list</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;SELECT v.idventa, v.codprop, p.direccion, p.municipio, p.tipo_propiedad, &quot;</span>
                <span class="s2">&quot;p.precio_venta FROM ventas AS v INNER JOIN propiedades as p on v.codprop = p.codigo WHERE v.facventa = :facventa&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:facventa&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">idFactura</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                    <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error en la ejecución de la consulta:&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="k">return</span> <span class="n">listado</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error listando facturas en listadoFacturas - conexión&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Conexion.bajaVenta">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.bajaVenta">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bajaVenta</span><span class="p">(</span><span class="n">idVenta</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Elimina una venta de la base de datos.</span>

<span class="sd">            Procedimiento:</span>
<span class="sd">            1. Prepara y ejecuta una consulta SQL para eliminar una venta por su ID.</span>
<span class="sd">            2. Devuelve True si la eliminación es exitosa, de lo contrario devuelve False.</span>

<span class="sd">            Excepciones:</span>
<span class="sd">            - Captura y muestra cualquier excepción que ocurra durante el proceso de eliminación de la venta.</span>

<span class="sd">            @param idVenta: ID de la venta a eliminar.</span>
<span class="sd">            @type idVenta: int</span>
<span class="sd">            @return: Éxito de la eliminación de la venta.</span>
<span class="sd">            @rtype: bool</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;DELETE FROM ventas WHERE idventa = :idventa&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:idventa&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">idVenta</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al eliminar una venta en conexion.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.altaPropiedadVenta">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.altaPropiedadVenta">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">altaPropiedadVenta</span><span class="p">(</span><span class="n">codigoPropiedad</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Actualiza el estado de una propiedad a &#39;Disponible&#39; y elimina la fecha de baja.</span>

<span class="sd">            Procedimiento:</span>
<span class="sd">            1. Prepara y ejecuta una consulta SQL para actualizar el estado de la propiedad y eliminar la fecha de baja.</span>
<span class="sd">            2. Devuelve True si la actualización es exitosa, de lo contrario devuelve False.</span>

<span class="sd">            Excepciones:</span>
<span class="sd">            - Captura y muestra cualquier excepción que ocurra durante el proceso de actualización.</span>

<span class="sd">            @param codigoPropiedad: Código de la propiedad a actualizar.</span>
<span class="sd">            @type codigoPropiedad: int</span>
<span class="sd">            @return: Éxito de la actualización de la propiedad.</span>
<span class="sd">            @rtype: bool</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;UPDATE propiedades SET estado = &#39;Disponible&#39;, baja = :fechaBaja WHERE codigo = :codigo&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:codigo&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">codigoPropiedad</span><span class="p">))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:fechaBaja&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QVariant</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al vender una Propiedad en conexion.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.cargaVenta">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.cargaVenta">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cargaVenta</span><span class="p">(</span><span class="n">codigoVenta</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Carga las ventas asociadas a una factura específica.</span>

<span class="sd">            Procedimiento:</span>
<span class="sd">            1. Prepara y ejecuta una consulta SQL para obtener las ventas asociadas a la factura.</span>
<span class="sd">            2. Recorre los resultados de la consulta y los añade a una lista.</span>

<span class="sd">            Excepciones:</span>
<span class="sd">            - Captura y muestra cualquier excepción que ocurra durante el proceso de obtención de datos.</span>

<span class="sd">            @param codigoVenta: Código de la factura para la cual se desean obtener las ventas.</span>
<span class="sd">            @type codigoVenta: int</span>
<span class="sd">            @return: Lista de ventas asociadas a la factura.</span>
<span class="sd">            @rtype: list</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">base_query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM ventas WHERE facventa = :codigoVenta&quot;</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">base_query</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:codigoVenta&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">codigoVenta</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                    <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error en la ejecución de la consulta:&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="k">return</span> <span class="n">listado</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al cargar ventas en conexion:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Conexion.cargaPropiedadVenta">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.cargaPropiedadVenta">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cargaPropiedadVenta</span><span class="p">(</span><span class="n">codigoPropiedad</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Carga los datos de una propiedad específica.</span>

<span class="sd">            Procedimiento:</span>
<span class="sd">            1. Prepara y ejecuta una consulta SQL para obtener los datos de la propiedad con el código proporcionado.</span>
<span class="sd">            2. Si se encuentra la propiedad, devuelve una lista con sus datos.</span>
<span class="sd">            3. Si no se encuentra la propiedad, devuelve None.</span>

<span class="sd">            Excepciones:</span>
<span class="sd">            - Captura y muestra cualquier excepción que ocurra durante el proceso de obtención de datos.</span>

<span class="sd">            @param codigoPropiedad: Código de la propiedad a buscar.</span>
<span class="sd">            @type codigoPropiedad: int</span>
<span class="sd">            @return: Lista con los datos de la propiedad o None si no se encuentra.</span>
<span class="sd">            @rtype: list or None</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM propiedades WHERE codigo = :id&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:id&quot;</span><span class="p">,</span> <span class="n">codigoPropiedad</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                    <span class="k">return</span> <span class="n">result</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No record found with the given id.&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error in query execution:&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error in selectById:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Conexion.cargaOneFactura">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.cargaOneFactura">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cargaOneFactura</span><span class="p">(</span><span class="n">idFactura</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param idFactura: La id de la factura</span>
<span class="sd">        :type idFactura: String</span>
<span class="sd">        :return: Lista con los datos de una factura</span>
<span class="sd">        :rtype: List</span>

<span class="sd">        Metodo para buscar una factura en concreto</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM facturas WHERE id = :id&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:id&quot;</span><span class="p">,</span> <span class="n">idFactura</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">registro</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error cargando factura en cargaOneFactura - conexión&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    GESTION DE ALQUILERES</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="Conexion.altaContratoAlquiler">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.altaContratoAlquiler">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">altaContratoAlquiler</span><span class="p">(</span><span class="n">nuevoAlquiler</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Añade un nuevo contrato de alquiler a la base de datos.</span>

<span class="sd">            Procedimiento:</span>
<span class="sd">            1. Prepara y ejecuta una consulta SQL para insertar un nuevo contrato de alquiler con los datos proporcionados.</span>
<span class="sd">            2. Si la inserción es exitosa, llama al método `altaMensualidades` para generar las mensualidades correspondientes.</span>
<span class="sd">            3. Actualiza el estado de la propiedad a &#39;Alquilado&#39; y establece la fecha de inicio del alquiler.</span>

<span class="sd">            Excepciones:</span>
<span class="sd">            - Captura y muestra cualquier excepción que ocurra durante el proceso de inserción del contrato de alquiler.</span>

<span class="sd">            @param nuevoAlquiler: Lista con los datos del nuevo contrato de alquiler.</span>
<span class="sd">                                  El primer elemento es el ID de la propiedad, el segundo es el DNI del cliente,</span>
<span class="sd">                                  el tercero es el ID del agente, el cuarto es la fecha de inicio del alquiler,</span>
<span class="sd">                                  el quinto es la fecha de fin del alquiler y el sexto es el precio del alquiler.</span>
<span class="sd">            @type nuevoAlquiler: list</span>
<span class="sd">            @return: Éxito de la inserción del contrato de alquiler.</span>
<span class="sd">            @rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO alquileres (propiedad_id, cliente_dni, agente_id, fecha_inicio, fecha_fin, precio_alquiler) &quot;</span>
                <span class="s2">&quot;VALUES (:idPropiedad, :vendedor, :dniCliente, :inicioAlquiler, :finAlquiler, :precioAlquiler)&quot;</span>
            <span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:idPropiedad&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevoAlquiler</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:vendedor&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevoAlquiler</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dniCliente&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevoAlquiler</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:inicioAlquiler&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevoAlquiler</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:finAlquiler&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevoAlquiler</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:precioAlquiler&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevoAlquiler</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="n">Conexion</span><span class="o">.</span><span class="n">altaMensualidades</span><span class="p">(</span><span class="n">nuevoAlquiler</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nuevoAlquiler</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">nuevoAlquiler</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">nuevoAlquiler</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

                <span class="n">update_query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">update_query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                    <span class="s2">&quot;UPDATE propiedades SET estado = &#39;Alquilado&#39;, baja = :fechaBaja WHERE codigo = :codigo&quot;</span>
                <span class="p">)</span>
                <span class="n">update_query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:fechaBaja&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QVariant</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">)))</span>
                <span class="n">update_query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:codigo&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nuevoAlquiler</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">update_query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error en la ejecución de la consulta de actualización:&quot;</span><span class="p">,</span> <span class="n">update_query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error en la ejecución de la consulta:&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al dar de alta contrato de alquiler en conexion:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.listadoContratosAlquileres">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listadoContratosAlquileres">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listadoContratosAlquileres</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Devuelve el listado de todos los contratos de alquiler.</span>

<span class="sd">            Procedimiento:</span>
<span class="sd">            1. Prepara y ejecuta una consulta SQL para obtener todos los contratos de alquiler.</span>
<span class="sd">            2. Recorre los resultados de la consulta y los añade a una lista.</span>

<span class="sd">            Excepciones:</span>
<span class="sd">            - Captura y muestra cualquier excepción que ocurra durante el proceso de obtención de datos.</span>

<span class="sd">            @param None</span>
<span class="sd">            @return list: Lista de todos los contratos de alquiler.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM alquileres&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                    <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error en la ejecución de la consulta:&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="k">return</span> <span class="n">listado</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error listando contratos de alquiler en listadoContratosAlquileres - conexión&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Conexion.altaMensualidades">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.altaMensualidades">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">altaMensualidades</span><span class="p">(</span><span class="n">propiedad_id</span><span class="p">,</span> <span class="n">fecha_inicio</span><span class="p">,</span> <span class="n">fecha_fin</span><span class="p">,</span> <span class="n">precio_mensual</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Añade mensualidades para un contrato de alquiler.</span>

<span class="sd">            Procedimiento:</span>
<span class="sd">            1. Convierte las fechas de inicio y fin a objetos datetime.</span>
<span class="sd">            2. Inserta una mensualidad para cada mes entre las fechas de inicio y fin.</span>
<span class="sd">            3. Marca cada mensualidad como no pagada.</span>

<span class="sd">            Parámetros:</span>
<span class="sd">            @param propiedad_id: ID de la propiedad.</span>
<span class="sd">            @type propiedad_id: int</span>
<span class="sd">            @param fecha_inicio: Fecha de inicio del contrato de alquiler en formato dd/mm/yyyy.</span>
<span class="sd">            @type fecha_inicio: str</span>
<span class="sd">            @param fecha_fin: Fecha de fin del contrato de alquiler en formato dd/mm/yyyy.</span>
<span class="sd">            @type fecha_fin: str</span>
<span class="sd">            @param precio_mensual: Precio mensual del alquiler.</span>
<span class="sd">            @type precio_mensual: float</span>

<span class="sd">            Retorna:</span>
<span class="sd">            @return: Éxito de la inserción de las mensualidades.</span>
<span class="sd">            @rtype: bool</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">fecha_inicio</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">fecha_inicio</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">)</span>
            <span class="n">fecha_fin</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">fecha_fin</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">)</span>

            <span class="k">while</span> <span class="n">fecha_inicio</span> <span class="o">&lt;=</span> <span class="n">fecha_fin</span><span class="p">:</span>
                <span class="n">mes</span> <span class="o">=</span> <span class="n">fecha_inicio</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%B&quot;</span><span class="p">)</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                    <span class="s2">&quot;INSERT INTO mensualidades (propiedad, mensualidad, importe, pagado) &quot;</span>
                    <span class="s2">&quot;VALUES (:propiedad, :mensualidad, :importe, :pagado)&quot;</span>
                <span class="p">)</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:propiedad&quot;</span><span class="p">,</span> <span class="n">propiedad_id</span><span class="p">)</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:mensualidad&quot;</span><span class="p">,</span> <span class="n">mes</span><span class="p">)</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:importe&quot;</span><span class="p">,</span> <span class="n">precio_mensual</span><span class="p">)</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:pagado&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># 0 indica que no está pagado</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al insertar la mensualidad de </span><span class="si">{</span><span class="n">mes</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>

                <span class="c1"># Avanzar al siguiente mes</span>
                <span class="k">if</span> <span class="n">fecha_inicio</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
                    <span class="n">fecha_inicio</span> <span class="o">=</span> <span class="n">fecha_inicio</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">fecha_inicio</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fecha_inicio</span> <span class="o">=</span> <span class="n">fecha_inicio</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="n">fecha_inicio</span><span class="o">.</span><span class="n">month</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al insertar mensualidades:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.listadoMensualidades">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listadoMensualidades">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listadoMensualidades</span><span class="p">(</span><span class="n">numContrato</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Devuelve el listado de todas las mensualidades.</span>

<span class="sd">            Procedimiento:</span>
<span class="sd">            1. Prepara y ejecuta una consulta SQL para obtener todas las mensualidades.</span>
<span class="sd">            2. Recorre los resultados de la consulta y los añade a una lista.</span>

<span class="sd">            Excepciones:</span>
<span class="sd">            - Captura y muestra cualquier excepción que ocurra durante el proceso de obtención de datos.</span>

<span class="sd">            @param None</span>
<span class="sd">            @return list: Lista de todas las mensualidades.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">base_query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM mensualidades WHERE propiedad IN (SELECT propiedad_id FROM alquileres WHERE propiedad_id = :numero_contrato)&quot;</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">base_query</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:numero_contrato&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">numContrato</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                    <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error en la ejecución de la consulta:&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="k">return</span> <span class="n">listado</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al cargar ventas en conexion:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span></div>

        <span class="c1">#     listado = []</span>
        <span class="c1">#     query = QtSql.QSqlQuery()</span>
        <span class="c1">#     query.prepare(&quot;SELECT * FROM mensualidades&quot;)</span>
        <span class="c1">#</span>
        <span class="c1">#     if query.exec():</span>
        <span class="c1">#         while query.next():</span>
        <span class="c1">#             fila = [query.value(i) for i in range(query.record().count())]</span>
        <span class="c1">#             listado.append(fila)</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         print(&quot;Error en la ejecución de la consulta:&quot;, query.lastError().text())</span>
        <span class="c1">#</span>
        <span class="c1">#     return listado</span>
        <span class="c1"># except Exception as e:</span>
        <span class="c1">#     print(&quot;Error listando mensualidades en listadoMensualidades - conexión&quot;, e)</span>
        <span class="c1">#     return []</span>

<div class="viewcode-block" id="Conexion.actualizarEstadoMensualidad">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.actualizarEstadoMensualidad">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">actualizarEstadoMensualidad</span><span class="p">(</span><span class="n">id_mensualidad</span><span class="p">,</span> <span class="n">estado</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Actualiza el estado de pago de una mensualidad.</span>

<span class="sd">            Procedimiento:</span>
<span class="sd">            1. Convierte el estado del checkbox a 1 (True) o 0 (False).</span>
<span class="sd">            2. Prepara y ejecuta una consulta SQL para actualizar el estado de la mensualidad.</span>
<span class="sd">            3. Devuelve True si la actualización es exitosa, de lo contrario devuelve False.</span>

<span class="sd">            Excepciones:</span>
<span class="sd">            - Captura y muestra cualquier excepción que ocurra durante el proceso de actualización del estado.</span>

<span class="sd">            @param id_mensualidad: ID de la mensualidad a actualizar.</span>
<span class="sd">            @type id_mensualidad: int</span>
<span class="sd">            @param estado: Estado del checkbox que indica si la mensualidad está pagada.</span>
<span class="sd">            @type estado: QtCore.Qt.CheckState</span>
<span class="sd">            @return: Éxito de la actualización del estado de la mensualidad.</span>
<span class="sd">            @rtype: bool</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mensualidad:&quot;</span><span class="p">,</span> <span class="n">id_mensualidad</span><span class="p">,</span> <span class="s2">&quot;estado:&quot;</span><span class="p">,</span> <span class="n">estado</span><span class="p">)</span>

            <span class="c1"># Convertimos el estado del checkbox a 1 (True) o 0 (False)</span>
            <span class="n">pagado</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">estado</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckState</span><span class="o">.</span><span class="n">Checked</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;estado check:&quot;</span><span class="p">,</span> <span class="n">pagado</span><span class="p">)</span>

            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE mensualidades SET pagado = :pagado WHERE id = :id&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:pagado&quot;</span><span class="p">,</span> <span class="n">pagado</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:id&quot;</span><span class="p">,</span> <span class="n">id_mensualidad</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estado actualizado: ID </span><span class="si">{</span><span class="n">id_mensualidad</span><span class="si">}</span><span class="s2">, Pagado = </span><span class="si">{</span><span class="n">pagado</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error actualizando el estado: </span><span class="si">{</span><span class="n">query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error en actualizarEstadoMensualidad: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.borrarContrato">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.borrarContrato">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">borrarContrato</span><span class="p">(</span><span class="n">id_contrato</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Borra un contrato de alquiler de la base de datos.</span>

<span class="sd">            Procedimiento:</span>
<span class="sd">            1. Obtiene el `propiedad_id` del contrato antes de borrarlo.</span>
<span class="sd">            2. Verifica si existen mensualidades pagadas para el contrato.</span>
<span class="sd">            3. Si existen mensualidades pagadas, muestra un mensaje de error y no borra el contrato.</span>
<span class="sd">            4. Borra las mensualidades asociadas al contrato.</span>
<span class="sd">            5. Borra el contrato de alquiler.</span>
<span class="sd">            6. Actualiza el estado de la propiedad a &#39;Disponible&#39;.</span>

<span class="sd">            Excepciones:</span>
<span class="sd">            - Captura y muestra cualquier excepción que ocurra durante el proceso de eliminación del contrato.</span>

<span class="sd">            @param id_contrato: ID del contrato de alquiler a eliminar.</span>
<span class="sd">            @type id_contrato: int</span>
<span class="sd">            @return: Éxito de la eliminación del contrato.</span>
<span class="sd">            @rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Obtener propiedad_id antes de borrar el contrato</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT propiedad_id FROM alquileres WHERE id = :id_contrato&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:id_contrato&quot;</span><span class="p">,</span> <span class="n">id_contrato</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al obtener propiedad_id:&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="n">propiedad_id</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Guardar el ID de la propiedad</span>

            <span class="c1"># Verificar si existen mensualidades pagadas para el contrato</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;SELECT COUNT(*) FROM mensualidades WHERE propiedad = :propiedad_id AND pagado = 1&quot;</span>
            <span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:propiedad_id&quot;</span><span class="p">,</span> <span class="n">propiedad_id</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">()</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">eventos</span><span class="o">.</span><span class="n">Eventos</span><span class="o">.</span><span class="n">crearMensajeError</span><span class="p">(</span>
                    <span class="s2">&quot;Mensualidades&quot;</span><span class="p">,</span> <span class="s2">&quot;No se puede borrar el contrato porque tiene mensualidades pagadas.&quot;</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No se puede borrar el contrato porque tiene mensualidades pagadas.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Borrar mensualidades asociadas al contrato</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;DELETE FROM mensualidades WHERE propiedad = :propiedad_id&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:propiedad_id&quot;</span><span class="p">,</span> <span class="n">propiedad_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al borrar mensualidades:&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Borrar el contrato</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;DELETE FROM alquileres WHERE id = :id_contrato&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:id_contrato&quot;</span><span class="p">,</span> <span class="n">id_contrato</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al borrar el contrato:&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Actualizar la propiedad a &#39;Disponible&#39;</span>
            <span class="n">update_query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">update_query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;UPDATE propiedades SET estado = &#39;Disponible&#39;, baja = NULL WHERE codigo = :propiedad_id&quot;</span>
            <span class="p">)</span>
            <span class="n">update_query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:propiedad_id&quot;</span><span class="p">,</span> <span class="n">propiedad_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">update_query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al actualizar la propiedad:&quot;</span><span class="p">,</span> <span class="n">update_query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Contrato </span><span class="si">{</span><span class="n">id_contrato</span><span class="si">}</span><span class="s2"> borrado correctamente.&quot;</span><span class="p">)</span>
            <span class="n">alquileres</span><span class="o">.</span><span class="n">Alquileres</span><span class="o">.</span><span class="n">cargaTablaContratos</span><span class="p">()</span>
            <span class="n">alquileres</span><span class="o">.</span><span class="n">Alquileres</span><span class="o">.</span><span class="n">cargaTablaMensualidades</span><span class="p">()</span>

            <span class="n">eventos</span><span class="o">.</span><span class="n">Eventos</span><span class="o">.</span><span class="n">resizeTablaAlquileresGestion</span><span class="p">()</span>
            <span class="n">eventos</span><span class="o">.</span><span class="n">Eventos</span><span class="o">.</span><span class="n">pnlVisualizacionAlquileres</span><span class="p">()</span>

            <span class="n">propiedades</span><span class="o">.</span><span class="n">Propiedades</span><span class="o">.</span><span class="n">cargarTablaPropiedades</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error en borrarContrato: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.cargaMensualidades">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.cargaMensualidades">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cargaMensualidades</span><span class="p">(</span><span class="n">numero_contrato</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Carga las mensualidades de un contrato de alquiler específico.</span>

<span class="sd">                Procedimiento:</span>
<span class="sd">                1. Prepara y ejecuta una consulta SQL para obtener las mensualidades del contrato.</span>
<span class="sd">                2. Recorre los resultados de la consulta y los añade a una lista.</span>

<span class="sd">                Excepciones:</span>
<span class="sd">                - Captura y muestra cualquier excepción que ocurra durante el proceso de obtención de datos.</span>

<span class="sd">                @param numero_contrato: Número del contrato de alquiler.</span>
<span class="sd">                @type numero_contrato: int</span>
<span class="sd">                @return: Lista de mensualidades del contrato de alquiler.</span>
<span class="sd">                @rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listado</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">base_query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM mensualidades WHERE propiedad IN (SELECT propiedad_id FROM alquileres WHERE id = :numero_contrato)&quot;</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">base_query</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:numero_contrato&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">numero_contrato</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                    <span class="n">listado</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error en la ejecución de la consulta:&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="k">return</span> <span class="n">listado</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al cargar ventas en conexion:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Conexion.datosOneAlquiler">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.datosOneAlquiler">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">datosOneAlquiler</span><span class="p">(</span><span class="n">idContrato</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Obtiene los datos de un contrato de alquiler específico.</span>

<span class="sd">            Procedimiento:</span>
<span class="sd">            1. Prepara y ejecuta una consulta SQL para obtener los datos del contrato de alquiler.</span>
<span class="sd">            2. Recorre los resultados de la consulta y los añade a una lista.</span>

<span class="sd">            Excepciones:</span>
<span class="sd">            - Captura y muestra cualquier excepción que ocurra durante el proceso de obtención de datos.</span>

<span class="sd">            @param idContrato: ID del contrato de alquiler.</span>
<span class="sd">            @type idContrato: int</span>
<span class="sd">            @return: Lista con los datos del contrato de alquiler.</span>
<span class="sd">            @rtype: list</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;SELECT a.id, a.fecha_inicio, a.fecha_fin, a.agente_id, c.dnicli, c.nomecli, c.apelcli, p.codigo, &quot;</span>
                <span class="s2">&quot;p.tipo_propiedad, p.precio_alquiler, p.municipio, p.direccion FROM alquileres as a &quot;</span>
                <span class="s2">&quot;INNER JOIN propiedades as p ON a.propiedad_id = p.codigo &quot;</span>
                <span class="s2">&quot;INNER JOIN clientes as c ON a.cliente_dni = c.dnicli WHERE a.id = :idAlquiler&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:idAlquiler&#39;</span><span class="p">,</span> <span class="n">idContrato</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
                        <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">registro</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error datosOneAlquiler: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.datosOneMensualidad">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.datosOneMensualidad">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">datosOneMensualidad</span><span class="p">(</span><span class="n">idMensualidad</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Obtiene los datos de una mensualidad específica.</span>

<span class="sd">            @param idMensualidad: ID de la mensualidad a buscar.</span>
<span class="sd">            @type idMensualidad: int</span>
<span class="sd">            @return: Lista con los datos de la mensualidad.</span>
<span class="sd">            @rtype: list</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT id, mensualidad, pagado FROM mensualidades WHERE id = :idMensualidad&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:idMensualidad&quot;</span><span class="p">,</span> <span class="n">idMensualidad</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">registro</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al cargar datos de una mensualidad en conexcion&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>
</div>


    <span class="c1"># @staticmethod</span>
    <span class="c1"># def getIdAlquilerByPropiedad(propiedad_id):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Devuelve el ID del alquiler asociado a una propiedad específica.</span>
    <span class="c1">#</span>
    <span class="c1">#     :param propiedad_id: ID de la propiedad</span>
    <span class="c1">#     :type propiedad_id: int</span>
    <span class="c1">#     :return: ID del alquiler asociado</span>
    <span class="c1">#     :rtype: int</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     try:</span>
    <span class="c1">#         query = QtSql.QSqlQuery()</span>
    <span class="c1">#         query.prepare(&quot;SELECT id FROM alquileres WHERE propiedad_id = :propiedad_id&quot;)</span>
    <span class="c1">#         query.bindValue(&quot;:propiedad_id&quot;, propiedad_id)</span>
    <span class="c1">#         if query.exec() and query.next():</span>
    <span class="c1">#             return query.value(0)</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             return None</span>
    <span class="c1">#     except Exception as e:</span>
    <span class="c1">#         print(&quot;Error al obtener el ID del alquiler por propiedad:&quot;, e)</span>
    <span class="c1">#         return None</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">PROYECTODAM24_25</a></h1>








<h3>Navegación</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Código de módulo</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Luis Guillermo Andre Garrido.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>